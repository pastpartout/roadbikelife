var start;let locked=!1,$flotmarker=$(".graphWrapper .marker"),wrapper=document.getElementById("distance-graph");const wheatherInterval=100,rideDataInterval=1e3,flotOptions={xaxis:{show:!1,position:"bottom",color:"black",axisLabel:"Distanz",tickFormatter:kmFormat,axisLabelUseCanvas:!0,axisLabelFontSizePixels:10,axisLabelFontFamily:"Verdana, Arial",axisLabelPadding:0},yaxes:[{show:!1}],grid:{show:!1,borderWidth:0,mouseActiveRadius:20,axisMargin:0,margin:0},series:{curvedLines:{active:!0}}};let markerInterval;if(wrapper){function getHighestValue(a){if(a){var t=[];return Object.keys(a).forEach(function(e){t.push(parseInt(a[e][1]))}),t.sort(function(e,a){return a-e}),1.1*t[0]}}function kmFormat(e,a){return(e/=1e3).toFixed(a.tickDecimals)+" km"}function kmhFormat(e,a){return(e*=3.6).toFixed(a.tickDecimals)+" km/h"}function mFormat(e,a){return e.toFixed(a.tickDecimals)+" m"}function createGraph(e,t,o){if(t){$("a[data-graph-name='"+e+"']").removeClass("d-none");var n=[{data:t,points:{symbol:"circle",fillColor:"#e51a51",show:!1},yaxis:1,shadowSize:0,color:"#e51a51",lines:{show:!0,fill:!1,lineWidth:2,fillColor:"#ced4da"},curvedLines:{apply:!0,monotonicFit:!1}}];$.plot(e,n,o).getAxes().yaxis.options.max=getHighestValue(t);let a=document.getElementById(e.replace("#",""));a.addEventListener("mousemove",function(e){!1===locked&&moveMarker(a,e)}),a.addEventListener("touchmove",function(e){moveMarker(a,e)}),a.addEventListener("touchstart",function(e){moveMarker(a,e)}),a.addEventListener("mousedown",function(e){!0===locked&&moveMarker(a,e),locked=!locked})}else $("a[data-graph-name='"+e+"']").addClass("d-none")}function slideMarker(){let e=start||.1;var a=document.getElementById("altitude-graph");e+=.1,99.9<e&&(e=.1),start=e,moveMarker(a,e)}function getOffsetPosition(e,a){for(var t={x:e.targetTouches?e.targetTouches[0].pageX:e.clientX,y:e.targetTouches?e.targetTouches[0].pageY:e.clientY};a.offsetParent;)t.x-=a.offsetLeft-a.scrollLeft,t.y-=a.offsetTop-a.scrollTop,a=a.offsetParent;return t}function moveMarker(e,a){let t=$(".graphWrapper .marker");var o,n;if(a.type?(n=(n=getOffsetPosition(a,e)).x,o=$(e).width(),r=map_data.coordinates.length,o=100/(o/n),n=map_data.coordinates[Math.floor(r/100*o)],start=o):(o=a,r=map_data.coordinates.length,n=map_data.coordinates[Math.floor(r/100*o)]),0<o&&o<=100){$(".detailNumbers .distance").text(getSpeedDataPointValue(o)),$(".detailNumbers .watts").text(getWattsDataPointValue(o)),$(".detailNumbers .heartrate").text(getHeartrateDataPointValue(o)),$(".detailNumbers .altitude").text(getElevationDataPointValue(o)),$(".windInfo .temp > span ").text(getTempValue(o)),map_data.wheather&&($("#wheather .wind .windInfo .windSpeed").text(getWindSpeedValue(o).toString().replace(/[.]/,",")),$("#wheatherIcon").attr("class","fal py-1 "+getWheatherIcon(o)));var r=getWindSpeedValuePercent(o);let e=$("#wheather .wind .windInfo .progress-bar"),a=$("#wheather .wind .windBearing");e.css("height",r+"%"),$("#wheather .wind .windBearing i").css("transform","rotate("+getWindBearingValue(o)),0<r&&(a.attr("class","windBearing text-success"),e.attr("class","progress-bar bg-success")),25<r&&(a.attr("class","windBearing text-info"),e.attr("class","progress-bar bg-info")),50<r&&(a.attr("class","windBearing text-warning"),e.attr("class","progress-bar bg-warning")),75<r&&(a.attr("class","windBearing text-danger"),e.attr("class","progress-bar bg-danger")),window.markerPosition.setPosition(n),localStorage.setItem("stravaMapMarkerPos",o),t.css({left:o+"%"})}}function startMarker(){markerInterval=setInterval(slideMarker,200),$("a.pause").removeClass("active"),$("a.play").addClass("active")}function stopMarker(){clearInterval(markerInterval),$("a.play").removeClass("active"),$("a.pause").addClass("active")}function getSpeedDataPointValue(e){var a=map_data.graphs.distance;if(0<a.length)return Math.floor(3.6*a[Math.floor(a.length/100*e)][1])}function getHeartrateDataPointValue(e){var a=map_data.graphs.heartrate;if(0<a.length)return Math.floor(a[Math.floor(a.length/100*e)][1])}function getWattsDataPointValue(e){var a=map_data.graphs.watts;if(0<a.length)return Math.floor(a[Math.floor(a.length/100*e)][1])}function getElevationDataPointValue(e){var a=map_data.graphs.altitude;if(a)return Math.floor(a[Math.floor(a.length/100*e)][1])}function getWindSpeedValue(e){if(0<map_data.wheather.length){e=Math.floor(map_data.wheather.length/100*e);return Math.round(10*map_data.wheather[e].windSpeed)/10}}function getTempValue(e){if(0<map_data.temp.length){e=Math.floor(map_data.temp.length/100*e);return map_data.temp[e]}}function getWindBearingValue(e){if(map_data.wheather){e=Math.floor(map_data.wheather.length/100*e);return map_data.wheather[e].windBearing+180+"deg"}}function getWindSpeedValuePercent(e){if(map_data.wheather){e=Math.floor(map_data.wheather.length/100*e),e=map_data.wheather[e].windSpeed/30*100;return Math.floor(e)}}function getWheatherIcon(e){if(0<map_data.wheather.length){e=Math.floor(map_data.wheather.length/100*e);return{"clear-day":"fa-sun","clear-night":"fa-moon",rain:"fa-cloud-rain",snow:"fa-cloud-snow",sleet:"fa-cloud-sleet",wind:"fa-wind",fog:"fa-fog",cloudy:"fa-clouds","partly-cloudy-day":"fa-clouds-sun","partly-cloudy-night":"fa-clouds-moon","01d":"fa-sun","01n":"fa-sun","02d":"fa-clouds-sun","02n":"fa-clouds-sun","03d":"fa-cloud","03n":"fa-cloud","04d":"fa-clouds","04n":"fa-clouds","09d":"fa-cloud-showers","09n":"fa-cloud-showers","10d":"fa-cloud-rain","10n":"fa-cloud-rain","11d":"fa-thunderstorm","11n":"fa-thunderstorm","13d":"fa-fog",13:"fa-fog"}[map_data.wheather[e].icon]}}for(let a in map_data.graphs){let e=map_data.graphs[a];createGraph("#"+a+"-graph",e,flotOptions)}$(".stravaGraph").on("touchstart mouseenter",function(){stopMarker()}),$("a.play").on("click",function(){locked=!1,$(this).hasClass("active")||startMarker()}),$("a.pause").on("click",function(){stopMarker()})}function isOnScreen(e){if(0!=e.length){var a=jQuery(window),t=a.scrollTop(),o=a.height(),n=t+o,r=jQuery(e),a=r.offset().top,e=r.height(),r=a+e;return t<=a&&a<n||t<r&&r<=n||o<e&&a<=t&&n<=r}}function zoomToObject(e,a){for(var t=new google.maps.LatLngBounds,o=e.getPath().getArray(),n=0;n<o.length;n++)t.extend(o[n]);a.fitBounds(t)}function iosFullscreen(e,a){const t=document.createElement("div");t.style.backgroundColor="#fff",t.style.border="2px solid #fff",t.style.borderRadius="3px",t.style.boxShadow="0 2px 6px rgba(0,0,0,.3)",t.style.marginRight="10px",t.style.marginTop="10px",t.style.lineHeight="1",t.style.height="40px",t.style.padding="8px 8px 7px",t.style.cursor="pointer",t.style.fontSize="22px",t.style.color="#666",t.style.textAlign="center",e.appendChild(t);e=document.createElement("div");t.innerHTML="<i class='fal fa-expand'></i>",t.appendChild(e);var o=document.querySelector("body"),n=document.getElementById("map-wrapper"),r=document.getElementById("googlemap");n.getBoundingClientRect();t.addEventListener("click",()=>{n.classList.toggle("fullscreen"),o.classList.toggle("gmap-fullscreen"),o.classList.contains("gmap-fullscreen")?(n.style.height=window.innerHeight+"px",r.style.height=window.innerHeight+"px"):(n.style.height=null,r.style.height=null)})}function initMap(t){function o(e,a,t,o){google.maps.event.addListener(e,"click",function(){t.setContent(o),t.open(a,e)})}var n=new google.maps.InfoWindow,e=/iPad|iPhone|iPod/.test(navigator.userAgent),r=new google.maps.Map(document.getElementById("googlemap"),{zoom:4,streetViewControl:!1,fullscreenControl:!e,styles:Joomla.gmap_styles_rbl_article}),a=new google.maps.Polyline({path:google.maps.geometry.encoding.decodePath(t.map_polyline),geodesic:!0,strokeColor:"#981539",strokeOpacity:1,strokeWeight:2,map:r}),s=[];if(!0===e){const f=document.createElement("div");f.classList.add("btn-fullscreen"),iosFullscreen(f,r),r.controls[google.maps.ControlPosition.TOP_RIGHT].push(f)}window.markerPosition=new google.maps.Marker({map:r,draggable:!1,icon:{url:"https://www.roadbikelife.de/images/map_markers/map_markers_position.svg?v6",scaledSize:new google.maps.Size(20,20),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(10,10)}});o(window.markerPosition,r,n,"<span class=\"stravaMapValueWrapper\">Keep rollin', rollin', rollin'</span>");new google.maps.Marker({position:t.coordinates[0],map:r,draggable:!1,icon:{url:"https://www.roadbikelife.de/images/map_markers/map_markers_start.svg",scaledSize:new google.maps.Size(30,30),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,15)}}),new google.maps.Marker({position:t.coordinates[t.coordinates.length-1],map:r,draggable:!1,icon:{url:"https://www.roadbikelife.de/images/map_markers/map_markers_end.svg?v6",scaledSize:new google.maps.Size(30,30),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,15)}});let i=document.createElement("div");i.classList.add("btn-group"),i.classList.add("btn-group-marker-btns"),i.style.marginBottom="25px";let l=document.createElement("div");l.classList.add("btn"),l.classList.add("btn-marker"),l.classList.add("btn-marker-zoom-out"),l.style.cursor="pointer";var d,e=document.createElement("div");l.innerHTML="<i class='fa fa-search-minus'></i>",l.appendChild(e),i.appendChild(l),l.addEventListener("click",()=>{zoomToObject(a,r)});let g=0;for(d in t.markers){let a=t.markers[d];if(void 0!==a.coordinates){if(0<=s.indexOf(a.coordinates.lat+","+a.coordinates.lng)){for(var c in t.coordinates){var p,m=t.coordinates[c];m.lat==a.coordinates.lat&&m.lng==a.coordinates.lng&&(m=parseInt(c)+1,p=t.coordinates[m])}void 0!==p&&(a.coordinates=p)}else s.push(a.coordinates.lat+","+a.coordinates.lng);var h=new google.maps.Marker({position:a.coordinates,map:r,draggable:!1,icon:{url:"https://www.roadbikelife.de/images/map_markers/map_markers_"+d+".svg?v6",scaledSize:new google.maps.Size(30,30),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,15)}});o(h,r,n,a.text);let e=document.createElement("div");e.classList.add("btn"),e.classList.add("btn-marker"),e.classList.add("btn-marker-"+d);var u=document.createElement("div");e.innerHTML="<img src='https://www.roadbikelife.de/images/map_markers/map_markers_"+d+".svg?v6'/>",e.appendChild(u),i.appendChild(e),e.addEventListener("click",function(){r.setZoom(13),r.panTo(a.coordinates),n.setContent(a.text),n.open(r,h),n.setPosition(a.coordinates)}),g++}}r.controls[google.maps.ControlPosition.BOTTOM_CENTER].push(i),t.photos.forEach(e=>{var a;e.location&&(a=new google.maps.Marker({position:{lat:e.location[0],lng:e.location[1]},map:r,draggable:!1,icon:{url:"https://www.roadbikelife.de/images/map_markers/map_markers_photo.svg?v3",scaledSize:new google.maps.Size(30,30),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,15)}}),e='<a href="'+e.urls[1e3]+'" data-fancybox="gmapsAcitivityImages"><img src="'+e.urls[250]+'" class="acitvityMapPhoto"></a>',o(a,r,n,e))}),t.segment_efforts&&t.segment_efforts.forEach(e=>{var a,t;void 0!==e.achievements[0]&&(t=1===(a=e.achievements[0].rank)?"map_markers_rank_"+a+".svg":"map_markers_rank_x.svg",a=new google.maps.Marker({position:{lat:e.segment.end_latlng[0],lng:e.segment.end_latlng[1]},map:r,draggable:!1,icon:{url:"https://www.roadbikelife.de/images/map_markers/"+t,scaledSize:new google.maps.Size(30,30),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,15)}}),t=new google.maps.Polyline({path:google.maps.geometry.encoding.decodePath(e.segment.map.polyline),geodesic:!0,strokeColor:"#f5cd5e",strokeOpacity:1,strokeWeight:4.2,map:r,position:{lat:e.segment.end_latlng[0],lng:e.segment.end_latlng[1]}}),e='<span class="stravaMapValueWrapper">'+e.tooltip_content+"</span>",o(a,r,n,e),o(t,r,n,e))}),zoomToObject(a,r)}
//# sourceMappingURL=init.js.map
